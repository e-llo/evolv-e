<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./public/style.css">
    <title>Evolv-e</title>

    <!-- A ordem de importar o script deve ser do que não depende de nada até os que dependem... (pra n bugar)-->
    <script type="text/javascript" src="./public/Classes/Vetor.js"></script>
    <script type="text/javascript" src="./public/Classes/Alimento.js"></script>
    <script type="text/javascript" src="./public/Classes/Organismo.js"></script>
    <script type="text/javascript" src="./public/Classes/Herbivoro.js"></script>
    <script type="text/javascript" src="./public/Classes/Carnivoro.js"></script>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <style>
        body{
            margin: 0
        }
    </style>
    <script type="text/javascript">
        var hora = minuto = segundo = milisegundo = 0;
        var segundos = 0;
    </script>
</head>

<body>
    <canvas></canvas>
    <div class="cronometro">
        <span id="hora">00</span>:<span id="minuto">00</span>:<span id="segundo">00</span>:<span id="milisegundo">00</span>
    </div>
    <div id="painel">
        <div id="info">
            <div class="container" class="slidecontainer">
                <div id="painelInicial">
                    <label id="carnivoro" name="carnivoro" for="inputCarnivoros">Carnívoros: <label id="numCarn">14</label></label>
                    <input type="range" min="0" max="200" value="14" class="slider-red" id="inputCarnivoros" oninput="numCarn.textContent=inputCarnivoros.value">
                    <label id="herbivoro" name="herbivoro" for="inputHerbivoros">Herbívoros: <label id="numHerb">100</label></label>
                    <input type="range" min="0" max="200" value="100" class="slider" id="inputHerbivoros" oninput="numHerb.textContent=inputHerbivoros.value">
                    <label id="alimento" name="alimento" for="inputAlimentos">Alimentos: <label id="numAli">150</label></label>
                    <input type="range" min="0" max="200" value="150" class="slider-yellow" id="inputAlimentos" oninput="numAli.textContent=inputAlimentos.value">
                    <label id="taxaalimento" name="taxaalimento" for="inputTaxaAlimentos">Aparição de alimentos: 1 a cada <label id="numTaxaAli">80</label> milissegundos</label>
                    <input type="range" min="1" max="1001" value="80" class="slider-yellow" id="inputTaxaAlimentos" oninput="mudouInputTaxa()"
                        onchange="mudaIntervaloAlimentos(inputTaxaAlimentos.value)">
                    <div id="botoesIniciais" class ="row mt-3">
                        <div class="col-sm-3 d-grid gap-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="restaurarPadroes()">Default</button>
                        </div>
                        <div class="col-sm-9 d-grid gap-2">
                            <button type="button" class="btn btn-sm btn-success" onclick="iniciarSimulacao()">Play</button>
                        </div>
                    </div>
                </div>
                <div id="painelSecundario" class="d-none">
                    <div class="d-grid gap-2 mt-4">
                        <button type="button" id="btnCarn" class="btn btn-sm btn-outline-danger" onclick="addCarnivoro()">Adicionar Carnívoro</button>
                        <button type="button" id="btnHerb" class="btn btn-sm btn-outline-success" onclick="addHerbivoro()">Adicionar Herbívoro</button>
                        <button type="button" id="btnAli"  class="btn btn-sm btn-outline-warning" onclick="addAlimento()">Adicionar Alimento</button>
                    </div>
                </div>

            </div>
        </div>
        <div>
            <label for = "divisao">Dividir populações</label>
            <input type="checkbox" id="divisao" name="divisao">
        </div>
        <!-- <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <div id="chart"></div>
            <a href="#">About</a>
            <a href="#">Services</a>
            <a href="#">Clients</a>
            <a href="#">Contact</a>
          </div> -->
        <div id="">
            <div id="chart"></div>
        </div>
    </div>
    

    <script type="text/javascript">
        const inputTalim = document.getElementById("inputTaxaAlimentos");
        const labelTaxa = document.getElementById("numTaxaAli");
        var n_carnivoros;
        var n_herbivoros;
        var n_alimentos;

        n_carnivoros = parseInt(document.getElementById("numCarn").textContent);
        n_herbivoros = parseInt(document.getElementById("numHerb").textContent);
        n_alimentos = parseInt(document.getElementById("numAli").textContent);

        var rodando = false;        

        // Variáveis para auxiliar a atualizar os valores dos sliders
        var sliderCarn = document.getElementById("inputCarnivoros");
        var outputCarn = document.getElementById("numCarn");
        outputCarn.innerHTML = sliderCarn.value;

        var sliderHerb = document.getElementById("inputHerbivoros");
        var outputHerb = document.getElementById("numHerb");
        outputHerb.innerHTML = sliderHerb.value;

        var sliderAli = document.getElementById("inputAlimentos");
        var outputAli = document.getElementById("numAli");
        outputAli.innerHTML = sliderAli.value;


        // Variável para escolher o gráfico que será mostrado
        var tipoGrafico = 1;


        // Update do valor do slider a cada vez que ele é modificado
        sliderCarn.oninput = function(){
            outputCarn.innerHTML = this.value;
            n_carnivoros = outputCarn.innerHTML;
        }
        sliderHerb.oninput = function(){
            outputHerb.innerHTML = this.value;
            n_herbivoros = outputHerb.innerHTML;
        }
        sliderAli.oninput = function(){
            outputAli.innerHTML = this.value;
            n_alimentos = outputAli.innerHTML;
        }


        function iniciarSimulacao(){ // não ta funcionando se coloco só no click do botão
            destroiObjetos();
            criaCronometro();
            criaObjetos(n_carnivoros, n_herbivoros, n_alimentos);
            mudaIntervaloAlimentos(inputTalim.value, true);
            document.getElementById("painelSecundario").classList.remove("d-none");
            if(!rodando) { animate(); };
            rodando = true;
        }
       
        function restaurarPadroes(){// volta os parâmetros para o padrão inicial
            document.getElementById("numCarn").textContent = 14;
            document.getElementById("inputCarnivoros").value = 14;

            document.getElementById("numHerb").textContent = 100;
            document.getElementById("inputHerbivoros").value = 100;

            document.getElementById("numAli").textContent = 150;
            document.getElementById("inputAlimentos").value = 150;
        }
        function addCarnivoro(){
            // na posição que o mouse clicar    
            var btnCarn = document.getElementById("btnCarn");
            if(btnCarn.classList.contains("active")){
                btnCarn.classList.remove("active");
                document.removeEventListener('click', geradorC, true);
            }else{
                btnCarn.classList.add("active");
                document.addEventListener('click', geradorC, true); 
            }
        }
        function geradorC(e){
            cursorX = e.pageX;
            cursorY= e.pageY;
            if(cursorX<=canvas.width && cursorY<=canvas.height){
                geraCarnivoro(cursorX,cursorY);
            }
        }

        function addHerbivoro(){
            var btnHerb = document.getElementById("btnHerb");
            if(btnHerb.classList.contains("active")){
                btnHerb.classList.remove("active");
                document.removeEventListener('click', geradorH, true);
            }else{
                btnHerb.classList.add("active");
                document.addEventListener('click', geradorH, true); 
            }
        }

        function geradorH(e){
            cursorX = e.pageX;
            cursorY= e.pageY;
            if(cursorX<=canvas.width && cursorY<=canvas.height){
                geraHerbivoro(cursorX,cursorY);
            }
            cursorX =null;
            cursorY = null;
        }



        function addAlimento(){
            var btnAli = document.getElementById("btnAli");
            if(btnAli.classList.contains("active")){
                btnAli.classList.remove("active");
                document.removeEventListener('click', geradorA, true);
            }else{
                btnAli.classList.add("active");
                document.addEventListener('click', geradorA, true); 
            }
        }

        function mudouInputTaxa() {
            if(inputTalim.value < 1001) {
                labelTaxa.textContent = inputTalim.value;
            } else {
                labelTaxa.textContent = "nenhum";
            }
        }
        function geradorA(e){
            cursorX = e.pageX;
            cursorY= e.pageY;
            if(cursorX<=canvas.width && cursorY<=canvas.height){
                geraAlimento(cursorX,cursorY);
            }
        }

        function sendData(dados){
            switch(tipoGrafico){
                case 1:
                    getDataPop(dados);
                    break;
                case 2:
                    getDataVel(dados);
                    break;
                case 3:
                    getDataForca(dados);
                    break;
                case 4:
                    getDataRaio(dados);
                    break;
                case 5:
                    getDataRaioDet(dados);
                    break;
                case 6:
                    getDataEner(dados);
                    break;
                case 7:
                    getDataTaxEner(dados);
                    break;
                }
        }

        /* Set the width of the side navigation to 250px */
        function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
        }

        /* Set the width of the side navigation to 0 */
        function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        }

    </script>
    <script type="text/javascript" src="./public/index.js"></script>
    <script type="text/javascript" src="./public/websocket.js"></script>
    <script type="text/javascript" src="./public/chart.js"></script>
</body>
</html>